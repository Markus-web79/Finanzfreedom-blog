name: Build and Deploy Blog

on:
  push:
    branches:
      - main
  schedule:
    - cron: "0 10 * * 2"  # Dienstag 10:00 Uhr
    - cron: "0 10 * * 4"  # Donnerstag 10:00 Uhr
    - cron: "0 10 * * 6"  # Samstag 10:00 Uhr

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ§­ Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ§  Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: ğŸ“¦ Install dependencies
        run: npm install
      - name: ğŸ” SEO QualitÃ¤tsprÃ¼fung
        run: |
          echo "ğŸ” PrÃ¼fe Artikel auf SEO-QualitÃ¤t..."
          node scripts/seoCheck.js
          
      - name: ğŸ§  Generiere Artikel
        run: |
          echo "ğŸ§  Generiere neuen Artikel..."
          node scripts/generateArticle.js

      - name: âš™ï¸ Generiere Vergleichsartikel
        run: |
          echo "âš™ï¸ Generiere neuen Vergleichsartikel..."
          node scripts/generateComparison.js

      - name: ğŸ—ï¸ Build static site
        run: |
          echo "ğŸ—ï¸ Baue statische Next.js Seite..."
          npx next build

      - name: ğŸŒ Sitemap generieren
        run: |
          echo "ğŸŒ Erstelle Sitemap..."
          node scripts/generateSitemap.js

      - name: ğŸš€ Deploy to Vercel
        run: |
          echo "ğŸš€ Deploy zur Live-Seite..."
          npx vercel --prod --token=${{ secrets.VERCEL_TOKEN }}

      - name: ğŸ” Ping search engines
        run: |
          echo "ğŸ” Melde neue Sitemap an Google & Bing..."
          node scripts/pingSearchEngines.js

      - name: ğŸ—„ï¸ Backup generierter Inhalte
        run: |
          echo "ğŸ—„ï¸ Erstelle Backup der generierten Inhalte..."
          zip -r backup_content_$(date +%Y%m%d).zip content/
          mkdir -p backups
          mv backup_content_*.zip backups/
