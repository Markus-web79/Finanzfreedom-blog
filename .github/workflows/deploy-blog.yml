name: ğŸš€ Build and Deploy Blog

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ§© Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ§© Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: ğŸ§© Install Dependencies
        run: npm install

      # WICHTIG â€“ Markdown Renderer
      - name: ğŸ§© Install missing markdown renderer
        run: npm install react-markdown

      # --------------------------
      # ğŸ”§ GENERATOR-SKRIPTE
      # --------------------------

      - name: ğŸ§  SEO QualitÃ¤tsprÃ¼fung
        run: node scripts/seoCheck.js

      - name: âœï¸ Generiere Artikel
        run: node scripts/generateArticle.js

      - name: âš–ï¸ Generiere Vergleichsartikel
        run: node scripts/generateComparison.js

      - name: ğŸ”— Interne Verlinkung
        run: node scripts/linkInternal.js

      - name: ğŸ—ºï¸ Sitemap generieren
        run: node scripts/generateSitemap.js

      - name: ğŸ“° RSS Feed generieren
        run: node scripts/generateFeed.js

      - name: ğŸ”” Suchmaschinen anpingen
        run: node scripts/pingSearchEngines.js

      # --------------------------
      # â—ï¸ ENTSCHEIDENDER FIX:
      # Projekt wirklich bauen VOR dem Deploy!
      # --------------------------
      - name: ğŸ› ï¸ Build Next.js project
        run: npm run build

      # --------------------------
      # ğŸš€ DEPLOY
      # --------------------------
      - name: ğŸš€ Deploy to Vercel
        run: npx vercel --prod --token=${{ secrets.VERCEL_TOKEN }}

      # --------------------------
      # ğŸ’¾ BACKUP
      # --------------------------
      - name: ğŸ’¾ Backup generierter Inhalte
        run: zip -r backup_$(date +%Y%m%d).zip content/
