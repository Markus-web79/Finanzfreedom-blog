// checkContent.js
import fs from "fs";
import path from "path";

const contentDir = path.join(process.cwd(), "content");
const logFile = path.join(process.cwd(), "corrections.log");

// Alle bisherigen Logs lÃ¶schen
if (fs.existsSync(logFile)) {
  fs.unlinkSync(logFile);
}

function logCorrection(file, before, after) {
  const entry = `ðŸ“„ ${file}\n   - ${before} ðŸ‘‰ ${after}\n`;
  fs.appendFileSync(logFile, entry);
}

function checkAndFixFile(filePath) {
  let content = fs.readFileSync(filePath, "utf8");
  let originalContent = content;

  // Regeln: Umlaute und typische Schreibweisen
  const rules = [
    { regex: /\bSteur\b/g, replace: "Steuer" },
    { regex: /\bSteÃ¼r/g, replace: "Steuer" },
    { regex: /\bVermoegen\b/g, replace: "VermÃ¶gen" },
    { regex: /\bFuehren\b/g, replace: "FÃ¼hren" },
    { regex: /\bOekonomie\b/g, replace: "Ã–konomie" },
    { regex: /\baufbaÃ¼n\b/g, replace: "aufbauen" },
    { regex: /\bÃ¼\b/g, replace: "Ã¼" },
    { regex: /\bÃ¼\b/g, replace: "Ã¼" },
    { regex: /\boe\b/g, replace: "Ã¶" },
    { regex: /\bae\b/g, replace: "Ã¤" },
  ];

  for (const { regex, replace } of rules) {
    if (regex.test(content)) {
      content = content.replace(regex, replace);
      logCorrection(path.basename(filePath), regex, replace);
    }
  }

  if (content !== originalContent) {
    fs.writeFileSync(filePath, content, "utf8");
  }
}

function run() {
  const files = fs.readdirSync(contentDir);

  files.forEach((file) => {
    if (file.endsWith(".md")) {
      const filePath = path.join(contentDir, file);
      checkAndFixFile(filePath);
    }
  });

  console.log("âœ… Content-Check abgeschlossen.");
}

run();
