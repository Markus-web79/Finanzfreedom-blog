// scripts/fixContent.js
// ------------------------------------------------------------
// Korrigiert alle Markdown-Dateien im /content-Ordner mithilfe
// des W√∂rterbuchs aus /dictionary.json
// ------------------------------------------------------------

import fs from "fs";
import path from "path";
import { fileURLToPath } from "url";

// Hilfsvariablen f√ºr __dirname in ES-Modulen
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// Pfade
const contentDir = path.join(__dirname, "..", "content");
const dictPath = path.join(__dirname, "..", "dictionary.json");

// W√∂rterbuch laden
let dictionary = {};
try {
  dictionary = JSON.parse(fs.readFileSync(dictPath, "utf8"));
  console.log(`üìñ W√∂rterbuch geladen: ${Object.keys(dictionary).length} Eintr√§ge`);
} catch (err) {
  console.error("‚ùå Fehler beim Laden des W√∂rterbuchs:", err);
  process.exit(1);
}

// Hilfsfunktion f√ºr Text-Korrektur
function fixText(text) {
  let fixed = text;
  for (const [wrong, correct] of Object.entries(dictionary)) {
    const regex = new RegExp(`\\b${wrong}\\b`, "gi"); // Wortweise ersetzen, case-insensitive
    fixed = fixed.replace(regex, correct);
  }
  return fixed;
}

// Alle Markdown-Dateien im content-Ordner durchgehen
const files = fs.readdirSync(contentDir).filter(f => f.endsWith(".md"));

if (files.length === 0) {
  console.log("‚ÑπÔ∏è Keine Markdown-Dateien gefunden.");
  process.exit(0);
}

let changes = 0;

for (const file of files) {
  const filePath = path.join(contentDir, file);
  const original = fs.readFileSync(filePath, "utf8");
  const fixed = fixText(original);

  if (fixed !== original) {
    fs.writeFileSync(filePath, fixed, "utf8");
    console.log(`‚úÖ Korrigiert: ${file}`);
    changes++;
  } else {
    console.log(`‚ö™ Keine √Ñnderungen: ${file}`);
  }
}

if (changes === 0) {
  console.log("‚ú® Alle Dateien waren bereits korrekt.");
} else {
  console.log(`üéâ ${changes} Datei(en) korrigiert.`);
}
