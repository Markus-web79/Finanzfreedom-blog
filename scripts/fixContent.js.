// scripts/fixContent.js
const fs = require("fs");
const path = require("path");

// Wörterbuch laden
const dictionaryPath = path.join(__dirname, "..", "dictionary.json");
const dictionary = JSON.parse(fs.readFileSync(dictionaryPath, "utf8"));

// Content-Ordner
const contentDir = path.join(__dirname, "..", "content");

// Alle Dateien im Content-Ordner durchgehen
function getAllMarkdownFiles(dir) {
  return fs.readdirSync(dir).flatMap(file => {
    const fullPath = path.join(dir, file);
    if (fs.statSync(fullPath).isDirectory()) {
      return getAllMarkdownFiles(fullPath);
    } else if (file.endsWith(".md")) {
      return [fullPath];
    } else {
      return [];
    }
  });
}

// Wörter ersetzen
function fixContent(text) {
  let fixed = text;
  for (const [wrong, correct] of Object.entries(dictionary)) {
    const regex = new RegExp(`\\b${wrong}\\b`, "gi"); // Wortgrenzen beachten
    fixed = fixed.replace(regex, correct);
  }
  return fixed;
}

// Dateien korrigieren
const files = getAllMarkdownFiles(contentDir);
let changedFiles = [];

files.forEach(file => {
  let content = fs.readFileSync(file, "utf8");
  const fixedContent = fixContent(content);

  if (content !== fixedContent) {
    fs.writeFileSync(file, fixedContent, "utf8");
    changedFiles.push(file);
  }
});

// Ergebnis anzeigen
if (changedFiles.length > 0) {
  console.log("✅ Korrigierte Dateien:");
  changedFiles.forEach(f => console.log(" - " + f));
  process.exit(0);
} else {
  console.log("✨ Keine Änderungen notwendig.");
  process.exit(0);
}
